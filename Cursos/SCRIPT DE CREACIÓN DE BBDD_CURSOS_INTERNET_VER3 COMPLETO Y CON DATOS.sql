/**********************************************************************************************************************************************
       ENUNCIADO:      CONTINÚA  ESTE  SCRIPT PARA OBTENER LA BASE DE DATOS 
       BBDD_CURSOS_INTERNET_VER 3 
*************************************************************************************************************************************************
 SCRIPT DE CREACIÓN DE LA BASE DE DATOS
                                  BBDD_CURSOS_INTERNET_VER 3
                                        ESPECIALIZACIÓN DE LA ENTIDAD PROFESOR                                                             *****************/
                                  
                                  
  DROP DATABASE IF EXISTS BBDD_CURSOS_INTERNET_V3;
  
  CREATE DATABASE IF NOT EXISTS  BBDD_CURSOS_INTERNET_V3;
  
  USE BBDD_CURSOS_INTERNET_V3;
  
  /*****************************  TABLA AULAS PARA GUARDAR ENTIDAD AULA  Y TABLA TELEFONOS_AULAS PARA SU ATRIBUTO
                                                  MULTIVALUADO****************************/
  DROP TABLE IF  EXISTS AULAS;
  CREATE TABLE IF  NOT EXISTS AULAS
  (
      ID_AULA INT  UNSIGNED NOT NULL  AUTO_INCREMENT,
      NOMBRE   ENUM ('SÓCRATES','ARISTÓTELES', 'PITÁGORAS','SÓFOCLES', 'PLATÓN') NOT NULL,
      LOCALIDAD  VARCHAR(30) NOT NULL,
      DIRECCION VARCHAR (45) NULL,
      PRIMARY KEY (ID_AULA),
      UNIQUE INDEX U_NOM_LOC (NOMBRE,LOCALIDAD)
       
  
  ) ENGINE INNODB;
  /*ALMACENAMOS 4 AULAS**/
  INSERT INTO AULAS
  (NOMBRE,LOCALIDAD,DIRECCION)
  VALUES
  ('SÓCRATES','VIGO',NULL),
  ('ARISTÓTELES','VIGO','AVDA CASTELAO 43'),
  ('SÓCRATES','NIGRÁN',NULL),
  ('SÓCRATES','REDONDELA',' CALLE LUGO 89, 3º'),
  ('PITÁGORAS', 'NIGRÁN',NULL);
  
  
  DROP TABLE IF EXISTS TELEFONOS_AULAS;
  CREATE TABLE IF NOT EXISTS TELEFONOS_AULAS
  ( 
       AULA  INT  UNSIGNED  NOT NULL,
       TELEFONO VARCHAR(10) NOT NULL,
       PRIMARY KEY (AULA, TELEFONO),
       FOREIGN KEY (AULA) REFERENCES AULAS(ID_AULA)
              ON DELETE CASCADE  /** SIEMPRE**/
              ON UPDATE CASCADE,
       INDEX FK_AULA_TLF (AULA)       
   
  )ENGINE INNODB;
  
  INSERT INTO TELEFONOS_AULAS
  (AULA, TELEFONO)
  VALUES
  (1,'986231456'),
  (1,'677452314'),
  (1,'623901267'),
  (2,'986454545'),
  (2,'666123344');
  
 
 
 
 
 
 /************  TABLA ALUMNOS    PARA GUARDAR ENTIDAD ALUMNO
                                                              ********************/
                                                              
  DROP TABLE IF EXISTS  ALUMNOS;
  CREATE TABLE IF NOT EXISTS ALUMNOS
  (
      DNI CHAR(9) NOT NULL,
      NOMBRE VARCHAR (50) NOT NULL,
      DIRECCION VARCHAR(60) NOT NULL,
      FECHA_NAC  DATE NOT NULL,
      TELEFONO  VARCHAR (10) NULL,
      E_MAIL     VARCHAR(45) NOT NULL,
      FOTO       BLOB NULL,
      DNI_DIG   BLOB NULL,
      AULA_ASIGNADA INT  UNSIGNED NOT NULL,
      PRIMARY KEY (DNI),
      /** RESTRICCIÓN DE UNICIDAD PARA COLUMNA E_MAIL, NOS SERVIRÁ DE CLAVE ALTERNATIVA**/
      UNIQUE INDEX AK_E_MAIL_ALUMNO (E_MAIL),
      FOREIGN KEY (AULA_ASIGNADA) REFERENCES AULAS(ID_AULA)
            ON DELETE RESTRICT 
            ON UPDATE CASCADE,
      INDEX FK_AULA_ASIGNADA (AULA_ASIGNADA)      
       
  
  ) ENGINE INNODB;
  
  INSERT INTO ALUMNOS
  (DNI, NOMBRE, DIRECCION, FECHA_NAC,TELEFONO,E_MAIL,FOTO, DNI_DIG, AULA_ASIGNADA)
  VALUES
  ('36987456A','MARIA LÓPEZ FERNÁNDEZ','C/OPORTO 23  VIGO', '2000-12-02', NULL, 'marialopez@gmail.com',NULL, NULL, 1),
  ('36987777A','ELENA GARCÍA FERNÁNDEZ', 'C/CAMELIAS 100 VIGO', '2000-11-02', NULL, 'elena2@gmail.com',NULL, NULL, 1),
  ('36123123J','MARIA  FERNÁNDEZ RUÍZ', 'C/NIGRÁN NIGRÁN', '2001-11-04', NULL, 'mfrg@mail.com',NULL, NULL, 2),
  ('38698745A','JUAN JOSE DAVILA LAGO', 'AVDA TRAVIESAS VIGO', '2000-06-05', NULL, 'jjdavila@gmail.com',NULL, NULL, 3);
   /******************************* TABLA   PROFESORES PARA GUARDAR ENTIDAD PROFESOR***********/
  
          /********* TABLA PROFESORES ES UNA SUPERCLASE**/
  DROP TABLE IF EXISTS PROFESORES;
  CREATE TABLE IF NOT EXISTS PROFESORES
  (
      DNI  CHAR(9) NOT NULL,
      NOMBRE VARCHAR(50) NOT NULL,
      FECHA_NAC DATE NOT NULL,
      E_MAIL VARCHAR (45) NOT NULL,
      FECHA_ALTA  DATE NOT NULL,
      SALARIO  FLOAT NOT NULL DEFAULT 1500.0,
      SUPERVISOR CHAR(9) NULL, /*PROFESOR PARTICIPA EN REL TENER SUPERVISOR OPTATIVA (0,1)**/
      DEPARTAMENTO INT UNSIGNED NOT NULL,
      PRIMARY KEY (DNI),
      UNIQUE INDEX AK_E_MAIL_PROF (E_MAIL),
      
       INDEX FK_PROFESOR_SUPERVISOR(SUPERVISOR),
       
       INDEX FK_DEPARTAMENTO_PERTENECE (DEPARTAMENTO)   
            
       
  
  ) ENGINE INNODB;
  
  INSERT INTO PROFESORES 
  (DNI, NOMBRE, FECHA_NAC,E_MAIL, FECHA_ALTA,SALARIO,SUPERVISOR, DEPARTAMENTO)
    VALUES
    ('11111111A','PEDRO DAVILACONDE','1980-12-02','pedro.davila@gamil.com','2000-10-01',DEFAULT, NULL, 1),
    ('22222222B','TERESA GARCÍA FREIRE','1988-11-12','TERESAGARCIA@GMAIL.COM','2000-10-01', 1300.0, NULL, 2),
    ('33333333C','JUAN MANUEL PEREZ PEREZ','1987-12-09', 'jmpp@gamil.com', '2001-10-01', DEFAULT, '11111111A', 1),
    ('44444444D', 'INES GÓMEZ GARCÍA','1988-05-12', 'ines.g.garcia@gmail.com', '2001-11-08', 1350.0, null, 2);
  
  
  /***** CUATRO TABLAS UNA PARA CADA SUBCLASE**/
  DROP TABLE IF EXISTS SUPERVISORES;
  CREATE TABLE IF NOT EXISTS SUPERVISORES
  (
      DNI CHAR(9) NOT NULL,
      PRIMARY KEY (DNI),  
      FOREIGN KEY (DNI) REFERENCES PROFESORES(DNI)
           ON DELETE CASCADE /*SIEMPRE, PORQUE UNA SUBCLASE DEPENDE EN EXISTENCIA DE LA SUPERCLASE**/
           ON UPDATE CASCADE
         
  
  
  )  ENGINE INNODB; /**MOTOR POR DEFECTO**/
  
   INSERT INTO SUPERVISORES
   (DNI)
   VALUES 
   ('11111111A');
  ALTER TABLE PROFESORES
     ADD FOREIGN KEY (SUPERVISOR) REFERENCES SUPERVISORES(DNI)
            ON DELETE SET NULL
            ON UPDATE CASCADE;
            
            
   DROP TABLE IF EXISTS ADMINISTRADORES;
  CREATE TABLE IF NOT EXISTS ADMINISTRADORES
  (
      DNI CHAR(9) NOT NULL,
      /*******************************/
      AULA INT  UNSIGNED NOT NULL,   /** ADMINISTRADOR PARTICIPA CON OBLIGATORIEDAD*/
      DIA_SEMANA  SET ('LUNES','MARTES','JUEVES') NOT NULL,
      PRECIO_HORA  FLOAT NOT NULL DEFAULT 120.5,
      NUM_HORAS_SEM INTEGER NOT NULL DEFAULT 5,
      /******************************************/
      PRIMARY KEY (DNI),  
      FOREIGN KEY (DNI) REFERENCES PROFESORES(DNI)
           ON DELETE CASCADE
           ON UPDATE CASCADE,
      FOREIGN KEY (AULA) REFERENCES AULAS (ID_AULA)
             ON DELETE CASCADE 
             ON UPDATE CASCADE,
      INDEX FK_AULA_ADMINISTRADA (AULA)  
         
  
  
  )  ENGINE INNODB; /**MOTOR POR DEFECTO**/
  INSERT INTO ADMINISTRADORES
  (DNI, AULA, DIA_SEMANA,PRECIO_HORA, NUM_HORAS_SEM)
  VALUES
  ('33333333C',1,'LUNES',DEFAULT,DEFAULT),
  ('44444444D', 1,'MARTES', DEFAULT, DEFAULT),
  ('22222222B', 2, 'JUEVES',150.0,12);
  
DROP TABLE IF EXISTS DIRECTORES;
  CREATE TABLE IF NOT EXISTS DIRECTORES
  (
      DNI CHAR(9) NOT NULL,
      PRIMARY KEY (DNI),  
      FOREIGN KEY (DNI) REFERENCES PROFESORES(DNI)
           ON DELETE CASCADE /*SIEMPRE, PORQUE UNA SUBCLASE DEPENDE EN EXISTENCIA DE LA SUPERCLASE**/
           ON UPDATE CASCADE
         
  
  
  )  ENGINE INNODB; /**MOTOR POR DEFECTO**/  
  
  
  INSERT INTO DIRECTORES
  (DNI)
  VALUES
  ('11111111A') , ('22222222B');
  
  DROP TABLE IF EXISTS EVALUADORES;
  CREATE TABLE IF NOT EXISTS EVALUADORES
  (
      DNI CHAR(9) NOT NULL,
      PRIMARY KEY (DNI),  
      FOREIGN KEY (DNI) REFERENCES PROFESORES(DNI)
           ON DELETE CASCADE /*SIEMPRE, PORQUE UNA SUBCLASE DEPENDE EN EXISTENCIA DE LA SUPERCLASE**/
           ON UPDATE CASCADE
         
  
  
  )  ENGINE INNODB; /**MOTOR POR DEFECTO**/
  
   INSERT INTO EVALUADORES
  (DNI)
  VALUES
  ('44444444D') , ('22222222B');
  
 
    /*****************************  TABLA DEPARTAMENTOS PARA GUARDAR  ENTIDAD DEPARTAMENTO*******/
  
  DROP TABLE IF EXISTS DEPARTAMENTOS;
  CREATE TABLE IF NOT EXISTS DEPARTAMENTOS
  (
    ID_DEPARTAMENTO INT UNSIGNED NOT NULL AUTO_INCREMENT,
    NOMBRE VARCHAR (20)  NOT NULL,
    E_MAIL     VARCHAR(45) NOT NULL,
    DIRECTOR  CHAR(9) NOT NULL, /*PORQUE DEPARTAMENTO PART OBLIGATORIAMENTE*/
    PRIMA    FLOAT NOT NULL DEFAULT 1200.0,
    FECHA    DATE NOT NULL,
       
    PRIMARY KEY(ID_DEPARTAMENTO),
    UNIQUE INDEX AK_E_MAIL_DEP (E_MAIL),
    FOREIGN KEY (DIRECTOR) REFERENCES DIRECTORES(DNI)
            ON DELETE RESTRICT
            ON UPDATE CASCADE,
     UNIQUE INDEX FK_DIRECTOR(DIRECTOR)       
  
    
  
  ) ENGINE INNODB;
  
  
  INSERT INTO DEPARTAMENTOS
  (NOMBRE,E_MAIL, DIRECTOR,PRIMA,FECHA)
  VALUES
  ('MATEMÁTICAS', 'clases.matematicas@gmail.com','11111111A',DEFAULT, '2000-11-12'),
  ('CIENCIAS','clases.ciencias@gmail.com','22222222B', DEFAULT, '2000-11-12');
  
  ALTER TABLE PROFESORES
      ADD FOREIGN KEY(DEPARTAMENTO) REFERENCES DEPARTAMENTOS(ID_DEPARTAMENTO)
           ON DELETE RESTRICT
           ON UPDATE CASCADE;
  
  
  
  
  
  
  /*******************************TABLA  CURSOS   PARA GUARDAR ENTIDAD CURSO ************************************************/
  DROP TABLE IF EXISTS CURSOS;
  CREATE TABLE IF NOT EXISTS CURSOS
  (
    ID_CURSO INT UNSIGNED  AUTO_INCREMENT NOT NULL,
    NOMBRE  VARCHAR(30) NOT NULL,
    DURACION   INT NOT NULL DEFAULT 300 ,
    PRECIO      FLOAT NOT NULL DEFAULT 650.0,
    URL_CURSO VARCHAR(100) NOT NULL,
    LIBRO  VARCHAR(60)  NULL,
    /*****************************************/
    EVALUADOR  CHAR(9) NOT NULL, /** CURSO PARTICIPA (1,1)**/
    FECHA_EVALUACION DATE NULL,
    HORA_EVALUACION  TIME NULL,
     /** LA RELACIÓN ES OBLIGATORIA, PERO ESTA VEZ LOS ATRIBUTOS SON OPTATIVOS**/
     DELEGADO CHAR(9)  NOT NULL,
    PRIMARY KEY (ID_CURSO),
    UNIQUE INDEX AK_NOMBRE_CURSO (NOMBRE),
    UNIQUE INDEX AK_URL_CURSO(URL_CURSO),
    FOREIGN KEY (EVALUADOR) REFERENCES EVALUADORES(DNI)
         ON DELETE RESTRICT
         ON UPDATE CASCADE,
    INDEX FK_PROF_EVALUADOR(EVALUADOR) ,
    FOREIGN KEY (DELEGADO) REFERENCES ALUMNOS(DNI)
          ON DELETE RESTRICT
          ON UPDATE CASCADE,
    UNIQUE INDEX FK_ALUMNO_DELEGADO(DELEGADO)      
  
  
  
  )ENGINE INNODB;
  
  INSERT INTO CURSOS
  (NOMBRE, URL_CURSO,EVALUADOR, DELEGADO)
  VALUES
  ('MATEMÁTICAS APLICADAS NIVEL I','www.academia.es\matematicas','22222222B','36987456A'),
  ('MATEMÁTICAS APLICADAS NIVEL II','www.academia.es\matematicasdos','22222222B', '36987777A'),
  ('CIENCIAS GRADO 1','`www.academia.es\cieniciasuno','44444444D','36123123J');
  
    /**************************  TABLA PARA RELACIÓN (N:M) PROFESOR IMPARTE CURSO***/
  
  DROP TABLE IF EXISTS PROFESORES_CURSOS;
  
  CREATE TABLE IF NOT EXISTS PROFESORES_CURSOS
  (
        PROFESOR  CHAR(9) NOT NULL,
        CURSO   INT UNSIGNED  NOT NULL,
        NUM_HORAS INT NOT NULL DEFAULT 7,
        PRECIO_HORA FLOAT NOT NULL  DEFAULT 120.0,
        
        PRIMARY KEY(PROFESOR, CURSO),
        FOREIGN KEY(PROFESOR) REFERENCES PROFESORES(DNI)
                             ON DELETE CASCADE
                             ON UPDATE CASCADE,
         INDEX FK_PROFEOSR_IMPARTE (PROFESOR),
         FOREIGN KEY (CURSO) REFERENCES CURSOS(ID_CURSO)
                             ON DELETE CASCADE
                             ON UPDATE CASCADE,
          INDEX FK_CURSO_IMPARTIDO (CURSO)                   
  
    
  ) ENGINE INNODB;
  
  
   /**************************  TABLA PARA RELACIÓN (N:M) ALUMNO MATRICULADO EN  CURSO***/
  DROP TABLE IF EXISTS ALUMNOS_CURSOS;
  
  CREATE TABLE IF NOT EXISTS ALUMNOS_CURSOS
  (
     ALUMNO CHAR(9) NOT NULL,
     CURSO   INT UNSIGNED  NOT NULL,
     FECHA_MATRICULA DATE NOT NULL,
     NOTA   ENUM ('APTO', 'NO APTO', 'SIN EVALUAR')  NOT NULL  DEFAULT 'SIN EVALUAR',
     PRIMARY KEY (ALUMNO, CURSO),
     FOREIGN KEY (ALUMNO) REFERENCES ALUMNOS(DNI)
                          ON DELETE CASCADE
                          ON UPDATE CASCADE,
     INDEX FK_ALUMNO_MATRICULADO(ALUMNO),                     
     FOREIGN KEY (CURSO) REFERENCES CURSOS(ID_CURSO)
                             ON DELETE RESTRICT
                             ON UPDATE CASCADE,
     INDEX FK_CURSO_IMPARTIDO (CURSO) 
  
  
  ) ENGINE INNODB;
 
 